{% extends "base.html" %}
{% block title %}Subdomain Scanner{% endblock %}

{% block content %}
<h3 class="text-white">🌐 Advanced Subdomain Scanner</h3>
<p class="mb-3 text-white">Discover all publicly accessible subdomains of a target domain using OSINT, DNS, and bruteforce techniques.</p>

<form method="POST" id="subForm">
  <div class="input-group mb-3">
    <input type="text" class="form-control" name="domain" placeholder="example.com" required>
    <button type="submit" class="btn btn-custom">Find Subdomains</button>
  </div>
</form>

<div id="progressContainer" class="mb-3"></div>

{% if target_submitted and not results %}
<div class="text-white mb-3">
    <i class="bi bi-hourglass-split"></i> 🕵️‍♂️ Hunting Subdomains… ⏳ Great Hackers Wait!
</div>
{% endif %}

{% if results %}
<h4 class="text-white">Found Subdomains ({{ results|length }})</h4>

<div class="mb-2">
    <button class="btn btn-secondary btn-sm" onclick="copyTable()">📋 Copy All</button>
</div>

<table class="table table-dark table-bordered table-hover text-white" id="subTable">
  <thead>
    <tr>
      <th>#</th>
      <th>Subdomain</th>
    </tr>
  </thead>
  <tbody>
  {% for sub in results %}
    <tr>
      <td>{{ loop.index }}</td>
      <td>{{ sub }}</td>
    </tr>
  {% endfor %}
  </tbody>
</table>

<form method="POST" action="{{ url_for('download_subdomains') }}" class="mt-3">
  <input type="hidden" name="domain" value="{{ request.form.get('domain') }}">
  <button type="submit" class="btn btn-success">📄 Download Report</button>
</form>
{% endif %}

<style>
#progressContainer p {
    animation: blink 1.2s infinite;
}
@keyframes blink {
    0% { opacity: 1; }
    50% { opacity: 0.3; }
    100% { opacity: 1; }
}
</style>

<script>
document.addEventListener("DOMContentLoaded", function() {
    const form = document.getElementById("subForm");
    const progressContainer = document.getElementById("progressContainer");

    form.addEventListener("submit", function() {
        progressContainer.innerHTML = "";
        const msg = document.createElement("p");
        msg.className = "mb-3 text-white";
        msg.innerHTML = '<i class="bi bi-hourglass-split"></i> 🕵️‍♂️ Hunting Subdomains… ⏳ Great Hackers Wait!';
        progressContainer.appendChild(msg);
    });
});

function copyTable() {
    let table = document.getElementById("subTable");
    let range, selection;
    if (document.createRange && window.getSelection) {
        range = document.createRange();
        selection = window.getSelection();
        selection.removeAllRanges();
        range.selectNodeContents(table);
        selection.addRange(range);
        document.execCommand('copy');
        alert("✅ Subdomains copied to clipboard!");
        selection.removeAllRanges();
    }
}
</script>
{% endblock %}
